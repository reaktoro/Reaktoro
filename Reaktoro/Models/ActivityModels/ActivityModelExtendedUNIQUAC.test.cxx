// Reaktoro is a unified framework for modeling chemically reactive systems.
//
// Copyright Â© 2014-2022 Allan Leal
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with this library. If not, see <http://www.gnu.org/licenses/>.

// Catch includes
#include <catch2/catch.hpp>

// Reaktoro includes
#include <Reaktoro/Common/Constants.hpp>
#include <Reaktoro/Common/Enumerate.hpp>
#include <Reaktoro/Core/Database.hpp>
#include <Reaktoro/Models/ActivityModels/ActivityModelExtendedUNIQUAC.hpp>
using namespace Reaktoro;

// Input values for (T, P, n) obtained by equilibrating T = [25.0, 100.0], P = [1.0, 100.0], mNaCl = [0.0, 2.0, 6.0], mCaSO4 = [0.0, 0.25], mBaCO3 = [0.0, 0.25] in 1 kg H2O
Vec<ArrayXd> inputs =
{
    ArrayXd{{ 25.00, 1.000, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00668854e-07, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00669643e-07 }},
    ArrayXd{{ 25.00, 1.000, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 1.000, 5.55084348e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.98874844e-08, 1.00000000e-16, 2.26482529e-07, 2.49999774e-01, 2.96369218e-07 }},
    ArrayXd{{ 25.00, 1.000, 5.55077081e+01, 2.49273043e-01, 7.26956165e-04, 4.23446786e-10, 1.00000000e-16, 2.50000000e-01, 4.06172818e-04, 1.00000000e-16, 3.20784233e-04, 2.49679216e-01, 3.86321167e-11 }},
    ArrayXd{{ 25.00, 1.000, 5.55084349e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.21016123e-07, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.21016912e-07 }},
    ArrayXd{{ 25.00, 1.000, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 2.50000000e-01, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 1.000, 5.55084349e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.12261080e-07, 2.00000000e+00, 4.53384145e-09, 2.49999995e-01, 1.16794126e-07 }},
    ArrayXd{{ 25.00, 1.000, 5.55079661e+01, 2.49531043e-01, 4.68956411e-04, 2.53825474e-10, 2.00000000e+00, 2.50000000e-01, 4.61592379e-04, 2.00000000e+00, 7.36455896e-06, 2.49992635e-01, 1.86829004e-11 }},
    ArrayXd{{ 25.00, 1.000, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 5.39966056e-08, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 5.39973941e-08 }},
    ArrayXd{{ 25.00, 1.000, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 2.50000000e-01, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 1.000, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 5.12551823e-08, 6.00000000e+00, 8.67667021e-12, 2.50000000e-01, 5.12630632e-08 }},
    ArrayXd{{ 25.00, 1.000, 5.55081561e+01, 2.49721032e-01, 2.78968246e-04, 1.00011825e-10, 6.00000000e+00, 2.50000000e-01, 2.78941565e-04, 6.00000000e+00, 2.68876109e-08, 2.49999973e-01, 6.35553217e-12 }},
    ArrayXd{{ 25.00, 100.0, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00668854e-07, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00669643e-07 }},
    ArrayXd{{ 25.00, 100.0, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 100.0, 5.55084348e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.98874844e-08, 1.00000000e-16, 2.26482529e-07, 2.49999774e-01, 2.96369218e-07 }},
    ArrayXd{{ 25.00, 100.0, 5.55077081e+01, 2.49273043e-01, 7.26956165e-04, 4.23446786e-10, 1.00000000e-16, 2.50000000e-01, 4.06172818e-04, 1.00000000e-16, 3.20784233e-04, 2.49679216e-01, 3.86321167e-11 }},
    ArrayXd{{ 25.00, 100.0, 5.55084349e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.21016123e-07, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.21016912e-07 }},
    ArrayXd{{ 25.00, 100.0, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 2.50000000e-01, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 100.0, 5.55084349e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.12261080e-07, 2.00000000e+00, 4.53384145e-09, 2.49999995e-01, 1.16794126e-07 }},
    ArrayXd{{ 25.00, 100.0, 5.55079661e+01, 2.49531043e-01, 4.68956411e-04, 2.53825474e-10, 2.00000000e+00, 2.50000000e-01, 4.61592379e-04, 2.00000000e+00, 7.36455896e-06, 2.49992635e-01, 1.86829004e-11 }},
    ArrayXd{{ 25.00, 100.0, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 5.39966056e-08, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 5.39973941e-08 }},
    ArrayXd{{ 25.00, 100.0, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 2.50000000e-01, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 25.00, 100.0, 5.55084350e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 5.12551823e-08, 6.00000000e+00, 8.67667021e-12, 2.50000000e-01, 5.12630632e-08 }},
    ArrayXd{{ 25.00, 100.0, 5.55081561e+01, 2.49721032e-01, 2.78968246e-04, 1.00011825e-10, 6.00000000e+00, 2.50000000e-01, 2.78941565e-04, 6.00000000e+00, 2.68876109e-08, 2.49999973e-01, 6.35553217e-12 }},
    ArrayXd{{ 100.0, 1.000, 5.55084343e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 7.27289828e-07, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 7.27290617e-07 }},
    ArrayXd{{ 100.0, 1.000, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 100.0, 1.000, 5.55084291e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.24078314e-07, 1.00000000e-16, 5.75142343e-06, 2.49994249e-01, 5.97550095e-06 }},
    ArrayXd{{ 100.0, 1.000, 5.55069951e+01, 2.48560034e-01, 1.43996122e-03, 4.52002362e-09, 1.00000000e-16, 2.50000000e-01, 2.07353361e-04, 1.00000000e-16, 1.23262221e-03, 2.48767378e-01, 5.31873870e-09 }},
    ArrayXd{{ 100.0, 1.000, 5.55084339e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.12310535e-06, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.12310613e-06 }},
    ArrayXd{{ 100.0, 1.000, 5.55079382e+01, 2.49503173e-01, 4.96825683e-04, 8.50961881e-10, 2.00000000e+00, 2.50000000e-01, 4.96829150e-04, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.76403419e-09 }},
    ArrayXd{{ 100.0, 1.000, 5.55084339e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.06734308e-06, 2.00000000e+00, 6.78379412e-08, 2.49999932e-01, 1.13518022e-06 }},
    ArrayXd{{ 100.0, 1.000, 5.55078868e+01, 2.49451733e-01, 5.48266079e-04, 8.46807410e-10, 2.00000000e+00, 2.50000000e-01, 5.33918284e-04, 2.00000000e+00, 1.43510601e-05, 2.49985649e-01, 1.57083588e-09 }},
    ArrayXd{{ 100.0, 1.000, 5.55084344e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 6.55338729e-07, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 6.55339517e-07 }},
    ArrayXd{{ 100.0, 1.000, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 2.50000000e-01, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 100.0, 1.000, 5.55084344e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 6.39275810e-07, 6.00000000e+00, 2.35484532e-11, 2.50000000e-01, 6.39298563e-07 }},
    ArrayXd{{ 100.0, 1.000, 5.55080508e+01, 2.49615696e-01, 3.84303359e-04, 5.16387327e-10, 6.00000000e+00, 2.50000000e-01, 3.84295988e-04, 6.00000000e+00, 9.14063915e-09, 2.49999991e-01, 7.35584893e-10 }},
    ArrayXd{{ 100.0, 100.0, 5.55084343e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 7.27289828e-07, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 7.27290617e-07 }},
    ArrayXd{{ 100.0, 100.0, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 100.0, 100.0, 5.55084291e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.24078314e-07, 1.00000000e-16, 5.75142343e-06, 2.49994249e-01, 5.97550095e-06 }},
    ArrayXd{{ 100.0, 100.0, 5.55069951e+01, 2.48560034e-01, 1.43996122e-03, 4.52002362e-09, 1.00000000e-16, 2.50000000e-01, 2.07353361e-04, 1.00000000e-16, 1.23262221e-03, 2.48767378e-01, 5.31873870e-09 }},
    ArrayXd{{ 100.0, 100.0, 5.55084339e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.12310535e-06, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.12310613e-06 }},
    ArrayXd{{ 100.0, 100.0, 5.55079382e+01, 2.49503173e-01, 4.96825683e-04, 8.50961881e-10, 2.00000000e+00, 2.50000000e-01, 4.96829150e-04, 2.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.76403419e-09 }},
    ArrayXd{{ 100.0, 100.0, 5.55084339e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 2.00000000e+00, 1.00000000e-16, 1.06734308e-06, 2.00000000e+00, 6.78379412e-08, 2.49999932e-01, 1.13518022e-06 }},
    ArrayXd{{ 100.0, 100.0, 5.55078868e+01, 2.49451733e-01, 5.48266079e-04, 8.46807410e-10, 2.00000000e+00, 2.50000000e-01, 5.33918284e-04, 2.00000000e+00, 1.43510601e-05, 2.49985649e-01, 1.57083588e-09 }},
    ArrayXd{{ 100.0, 100.0, 5.55084344e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 6.55338729e-07, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 6.55339517e-07 }},
    ArrayXd{{ 100.0, 100.0, 5.55084351e+01, 2.50000000e-01, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 2.50000000e-01, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16 }},
    ArrayXd{{ 100.0, 100.0, 5.55084344e+01, 1.00000000e-16, 1.00000000e-16, 1.00000000e-16, 6.00000000e+00, 1.00000000e-16, 6.39275810e-07, 6.00000000e+00, 2.35484532e-11, 2.50000000e-01, 6.39298563e-07 }},
    ArrayXd{{ 100.0, 100.0, 5.55080508e+01, 2.49615696e-01, 3.84303359e-04, 5.16387327e-10, 6.00000000e+00, 2.50000000e-01, 3.84295988e-04, 6.00000000e+00, 9.14063915e-09, 2.49999991e-01, 7.35584893e-10 }},
};

// Expected output values for activity coefficients (log10 scale) and Gx
Vec<ArrayXd> outputs =
{
    ArrayXd{{ -3.5903389613934785e+01,  9.2355054358806701e+03, -2.7268034918575495e+02,  1.9755796740925064e+10, -3.8548600550799403e+09,  3.3189649943428713e+03, -2.0887587346744417e-04,  4.0531247035848152e+43,  7.2864942301786736e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -1.7475047809500200e+04 }},
    ArrayXd{{ -3.5870271766433802e+01,  9.2356215204989803e+03, -2.7267054857255147e+02,  1.9755796740283298e+10, -8.2497575614604671e+01,  3.3183710030229104e+03, -2.6620207460755962e-01,  4.0531247035848152e+43,  7.2864942301786736e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -1.8369528799551026e+04 }},
    ArrayXd{{ -4.2171276316014925e+01,  9.2356019430256965e+03, -2.7273835672256939e+02,  1.9755796728128189e+10, -1.1361520903984127e+10,  3.3182612612081166e+03, -2.5850585974206469e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -2.0762234287381303e+04 }},
    ArrayXd{{ -4.2138642638527585e+01,  9.2357095134964020e+03, -2.7254420650488538e+02,  1.9755796728244545e+10, -1.4360762250620712e+07,  3.3184252858851391e+03, -3.3352448213645208e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -2.1624446149727231e+04 }},
    ArrayXd{{ -5.8561691109358357e+01,  9.1961438879253747e+03, -4.1342750410120630e+02,  1.9755796740863739e+10, -9.4119190904353673e+01,  3.0830425512504012e+03, -4.9838939701798879e-01,  4.0531247035848152e+43,  7.2864942301786624e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.0536283872563341e+04 }},
    ArrayXd{{ -5.8536816279024329e+01,  9.1962146256509659e+03, -4.1323901188561337e+02,  1.9755796741057812e+10, -8.3228086934250953e+01,  3.0833031490625681e+03, -5.3489696776016782e-01,  4.0531247035848152e+43,  7.2864942301786624e+16,  4.8671967628026825e+32,  5.0200143019693494e+30, -3.1636109378310084e+04 }},
    ArrayXd{{ -5.8542714992593545e+01,  9.1962037868660755e+03, -4.1329069353999273e+02,  1.9755796728928577e+10, -9.4787960097605364e+01,  3.0832132471885834e+03, -5.2988374932598825e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.0941559635367539e+04 }},
    ArrayXd{{ -5.8518829380267007e+01,  9.1962706444474261e+03, -4.1310630498214385e+02,  1.9755796729125122e+10, -9.0233123576262216e+01,  3.0834755810477036e+03, -5.6298735126147670e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.2134649423525232e+04 }},
    ArrayXd{{ -5.8999246653128040e+01,  9.1956157591303490e+03, -4.1596502463408586e+02,  1.9755796742584820e+10, -9.3762576083539344e+01,  3.0783728575709974e+03, -7.8722847045872224e-01,  4.0531247035848152e+43,  7.2864942301786608e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.4466781119173291e+04 }},
    ArrayXd{{ -5.8983804174361033e+01,  9.1956518216330551e+03, -4.1583506017381404e+02,  1.9755796742736752e+10, -8.3287882127440497e+01,  3.0785796208228371e+03, -8.0534359259244759e-01,  4.0531247035848152e+43,  7.2864942301786608e+16,  4.8671967628026825e+32,  5.0200143019693291e+30, -3.5128540276877742e+04 }},
    ArrayXd{{ -5.8987411209966282e+01,  9.1956472506971040e+03, -4.1586737509666455e+02,  1.9755796730647671e+10, -9.3961534827461662e+01,  3.0785202791990705e+03, -8.0241367831105215e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.4815675358948196e+04 }},
    ArrayXd{{ -5.8972389557423796e+01,  9.1956820378034299e+03, -4.1574057128652242e+02,  1.9755796730796654e+10, -8.9272667598795422e+01,  3.0787229839172737e+03, -8.1984902105014834e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.5716071212561023e+04 }},
    ArrayXd{{ -3.5903389613934785e+01,  9.2355054358806701e+03, -2.7268034918575495e+02,  1.9755796740925064e+10, -3.8548600550799403e+09,  3.3189649943428713e+03, -2.0887587346744417e-04,  4.0531247035848152e+43,  7.2864942301786736e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -1.7475047809500200e+04 }},
    ArrayXd{{ -3.5870271766433802e+01,  9.2356215204989803e+03, -2.7267054857255147e+02,  1.9755796740283298e+10, -8.2497575614604671e+01,  3.3183710030229104e+03, -2.6620207460755962e-01,  4.0531247035848152e+43,  7.2864942301786736e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -1.8369528799551026e+04 }},
    ArrayXd{{ -4.2171276316014925e+01,  9.2356019430256965e+03, -2.7273835672256939e+02,  1.9755796728128189e+10, -1.1361520903984127e+10,  3.3182612612081166e+03, -2.5850585974206469e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -2.0762234287381303e+04 }},
    ArrayXd{{ -4.2138642638527585e+01,  9.2357095134964020e+03, -2.7254420650488538e+02,  1.9755796728244545e+10, -1.4360762250620712e+07,  3.3184252858851391e+03, -3.3352448213645208e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -2.1624446149727231e+04 }},
    ArrayXd{{ -5.8561691109358357e+01,  9.1961438879253747e+03, -4.1342750410120630e+02,  1.9755796740863739e+10, -9.4119190904353673e+01,  3.0830425512504012e+03, -4.9838939701798879e-01,  4.0531247035848152e+43,  7.2864942301786624e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.0536283872563341e+04 }},
    ArrayXd{{ -5.8536816279024329e+01,  9.1962146256509659e+03, -4.1323901188561337e+02,  1.9755796741057812e+10, -8.3228086934250953e+01,  3.0833031490625681e+03, -5.3489696776016782e-01,  4.0531247035848152e+43,  7.2864942301786624e+16,  4.8671967628026825e+32,  5.0200143019693494e+30, -3.1636109378310084e+04 }},
    ArrayXd{{ -5.8542714992593545e+01,  9.1962037868660755e+03, -4.1329069353999273e+02,  1.9755796728928577e+10, -9.4787960097605364e+01,  3.0832132471885834e+03, -5.2988374932598825e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.0941559635367539e+04 }},
    ArrayXd{{ -5.8518829380267007e+01,  9.1962706444474261e+03, -4.1310630498214385e+02,  1.9755796729125122e+10, -9.0233123576262216e+01,  3.0834755810477036e+03, -5.6298735126147670e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.2134649423525232e+04 }},
    ArrayXd{{ -5.8999246653128040e+01,  9.1956157591303490e+03, -4.1596502463408586e+02,  1.9755796742584820e+10, -9.3762576083539344e+01,  3.0783728575709974e+03, -7.8722847045872224e-01,  4.0531247035848152e+43,  7.2864942301786608e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.4466781119173291e+04 }},
    ArrayXd{{ -5.8983804174361033e+01,  9.1956518216330551e+03, -4.1583506017381404e+02,  1.9755796742736752e+10, -8.3287882127440497e+01,  3.0785796208228371e+03, -8.0534359259244759e-01,  4.0531247035848152e+43,  7.2864942301786608e+16,  4.8671967628026825e+32,  5.0200143019693291e+30, -3.5128540276877742e+04 }},
    ArrayXd{{ -5.8987411209966282e+01,  9.1956472506971040e+03, -4.1586737509666455e+02,  1.9755796730647671e+10, -9.3961534827461662e+01,  3.0785202791990705e+03, -8.0241367831105215e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.4815675358948196e+04 }},
    ArrayXd{{ -5.8972389557423796e+01,  9.1956820378034299e+03, -4.1574057128652242e+02,  1.9755796730796654e+10, -8.9272667598795422e+01,  3.0787229839172737e+03, -8.1984902105014834e-01,  4.0531247035848152e+43,  7.2864942301786592e+16,  4.8671967628026825e+32,  5.0200143019693601e+30, -3.5716071212561023e+04 }},
    ArrayXd{{ -6.3858875265592586e-06,  2.4637887214385742e-02, -4.3674716184143253e-04,  4.3993976473010343e-01, -8.6499327967949284e+00,  8.9726867814630434e-02, -4.6201418661854544e-04,  1.9121588096371794e+04,  6.4682839902028748e+00,  1.9526732110886960e+03,  9.7626298510100889e+02, -5.3404402075922741e+00 }},
    ArrayXd{{ -8.3483277532151456e-03,  9.6817103044862129e-01,  5.0279366526404391e-02,  1.4801927834168589e+01, -6.7372058827362413e-01,  2.5510950735371392e+00, -2.2631221820748318e-01,  3.2098014575991436e+05,  2.2434807703084741e+02,  6.7558250502555646e+04,  3.3776783405063041e+04, -2.3657141163253175e+02 }},
    ArrayXd{{ -4.2917776767113960e+00,  5.4786660395929241e+00, -2.7222196146682304e+01,  9.5893403389269281e+01, -1.2152509897656584e+01,  1.9459656550980629e+01, -2.1861632458487085e-01,  4.1771563593655475e+06,  1.4098942862745523e+03,  4.2656595215711172e+05,  2.1326699713655535e+05, -9.6531777459848363e+03 }},
    ArrayXd{{ -4.2897929914373210e+00,  5.5861674480016328e+00, -2.7001951489380367e+01,  9.6032167610993440e+01, -1.0163735673753258e+01,  1.9470005702350409e+01, -2.8706634615839993e-01,  3.8365725998057229e+06,  1.4105853277750953e+03,  4.2656543485073972e+05,  2.1326682581811160e+05, -9.5992635639900946e+03 }},
    ArrayXd{{ -6.8870170443787488e+00, -5.5525884795057081e+00, -5.8193519242634167e+01,  9.6645145107395820e+01, -1.3036625259728387e+01, -6.7348245761778529e+01, -4.4571982851432296e-01,  4.1784595560607025e+06,  1.4108118491329610e+03,  4.2669633801560389e+05,  2.0634552669141113e+05, -1.5896061812496482e+04 }},
    ArrayXd{{ -6.8463278771852192e+00, -5.4574073122301074e+00, -5.7999499459546946e+01,  9.6846690057291312e+01, -1.2817181922093200e+01, -6.6163776368314885e+01, -4.8041857952530048e-01,  4.1784581228941320e+06,  1.4113834924813616e+03,  4.2669657337552239e+05,  2.0629339402178442e+05, -1.6573781329826437e+04 }},
    ArrayXd{{ -6.8884377461368764e+00, -5.4926889549078979e+00, -5.8055736680696342e+01,  9.6731557574595584e+01, -1.3386265686164766e+01, -6.7170161665370813e+01, -4.7537035857470405e-01,  4.1784599297770751e+06,  1.4091190917481781e+03,  4.2669652151584520e+05,  2.0650702632966387e+05, -1.6159195322691823e+04 }},
    ArrayXd{{ -6.8487457281953672e+00, -5.4014479388783077e+00, -5.7866283919142241e+01,  9.6933820589810821e+01, -1.3164585724007800e+01, -6.5985584320208574e+01, -5.0703178471497212e-01,  4.1784584924765574e+06,  1.4096721208497995e+03,  4.2669675683202728e+05,  2.0645674379383339e+05, -1.6830075848741162e+04 }},
    ArrayXd{{ -7.4102345129666922e+00, -6.2099945708043203e+00, -6.0741885673237533e+01,  9.8315138218363899e+01, -1.4841823624603173e+01, -7.6847924184065562e+01, -7.2631003311339271e-01,  4.1784702785371202e+06,  1.4094151869799832e+03,  4.2669586682178959e+05,  2.0630114435718718e+05, -1.9641465112344766e+04 }},
    ArrayXd{{ -7.3766401965453543e+00, -6.1460126443180583e+00, -6.0607282845702564e+01,  9.8469132607852018e+01, -1.4584194915718982e+01, -7.5589154740650969e+01, -7.4390950632335118e-01,  4.1784696767956782e+06,  1.4097878254662505e+03,  4.2669604673321318e+05,  2.0629101970194202e+05, -2.0282061996036166e+04 }},
    ArrayXd{{ -7.4074603951134925e+00, -6.1785026398833507e+00, -6.0644019569320605e+01,  9.8378507525431942e+01, -1.5012512144831009e+01, -7.6698427309937486e+01, -7.4097962025258279e-01,  4.1784704175345944e+06,  1.4085266119595954e+03,  4.2669600050599559e+05,  2.0635610421150943e+05, -1.9862821300357693e+04 }},
    ArrayXd{{ -7.3742831338771442e+00, -6.1157895171281531e+00, -6.0512611476848711e+01,  9.8529402342160580e+01, -1.4754763211917298e+01, -7.5443953331033356e+01, -7.5795209760168414e-01,  4.1784698121876814e+06,  1.4088895868826380e+03,  4.2669617672579503e+05,  2.0634639592385417e+05, -2.0498639689183365e+04 }},
    ArrayXd{{ -6.3858875265592586e-06,  2.4637887214385742e-02, -4.3674716184143253e-04,  4.3993976473010343e-01, -8.6499327967949284e+00,  8.9726867814630434e-02, -4.6201418661854544e-04,  1.9121588096371794e+04,  6.4682839902028748e+00,  1.9526732110886960e+03,  9.7626298510100889e+02, -5.3404402075922741e+00 }},
    ArrayXd{{ -8.3483277532151456e-03,  9.6817103044862129e-01,  5.0279366526404391e-02,  1.4801927834168589e+01, -6.7372058827362413e-01,  2.5510950735371392e+00, -2.2631221820748318e-01,  3.2098014575991436e+05,  2.2434807703084741e+02,  6.7558250502555646e+04,  3.3776783405063041e+04, -2.3657141163253175e+02 }},
    ArrayXd{{ -4.2917776767113960e+00,  5.4786660395929241e+00, -2.7222196146682304e+01,  9.5893403389269281e+01, -1.2152509897656584e+01,  1.9459656550980629e+01, -2.1861632458487085e-01,  4.1771563593655475e+06,  1.4098942862745523e+03,  4.2656595215711172e+05,  2.1326699713655535e+05, -9.6531777459848363e+03 }},
    ArrayXd{{ -4.2897929914373210e+00,  5.5861674480016328e+00, -2.7001951489380367e+01,  9.6032167610993440e+01, -1.0163735673753258e+01,  1.9470005702350409e+01, -2.8706634615839993e-01,  3.8365725998057229e+06,  1.4105853277750953e+03,  4.2656543485073972e+05,  2.1326682581811160e+05, -9.5992635639900946e+03 }},
    ArrayXd{{ -6.8870170443787488e+00, -5.5525884795057081e+00, -5.8193519242634167e+01,  9.6645145107395820e+01, -1.3036625259728387e+01, -6.7348245761778529e+01, -4.4571982851432296e-01,  4.1784595560607025e+06,  1.4108118491329610e+03,  4.2669633801560389e+05,  2.0634552669141113e+05, -1.5896061812496482e+04 }},
    ArrayXd{{ -6.8463278771852192e+00, -5.4574073122301074e+00, -5.7999499459546946e+01,  9.6846690057291312e+01, -1.2817181922093200e+01, -6.6163776368314885e+01, -4.8041857952530048e-01,  4.1784581228941320e+06,  1.4113834924813616e+03,  4.2669657337552239e+05,  2.0629339402178442e+05, -1.6573781329826437e+04 }},
    ArrayXd{{ -6.8884377461368764e+00, -5.4926889549078979e+00, -5.8055736680696342e+01,  9.6731557574595584e+01, -1.3386265686164766e+01, -6.7170161665370813e+01, -4.7537035857470405e-01,  4.1784599297770751e+06,  1.4091190917481781e+03,  4.2669652151584520e+05,  2.0650702632966387e+05, -1.6159195322691823e+04 }},
    ArrayXd{{ -6.8487457281953672e+00, -5.4014479388783077e+00, -5.7866283919142241e+01,  9.6933820589810821e+01, -1.3164585724007800e+01, -6.5985584320208574e+01, -5.0703178471497212e-01,  4.1784584924765574e+06,  1.4096721208497995e+03,  4.2669675683202728e+05,  2.0645674379383339e+05, -1.6830075848741162e+04 }},
    ArrayXd{{ -7.4102345129666922e+00, -6.2099945708043203e+00, -6.0741885673237533e+01,  9.8315138218363899e+01, -1.4841823624603173e+01, -7.6847924184065562e+01, -7.2631003311339271e-01,  4.1784702785371202e+06,  1.4094151869799832e+03,  4.2669586682178959e+05,  2.0630114435718718e+05, -1.9641465112344766e+04 }},
    ArrayXd{{ -7.3766401965453543e+00, -6.1460126443180583e+00, -6.0607282845702564e+01,  9.8469132607852018e+01, -1.4584194915718982e+01, -7.5589154740650969e+01, -7.4390950632335118e-01,  4.1784696767956782e+06,  1.4097878254662505e+03,  4.2669604673321318e+05,  2.0629101970194202e+05, -2.0282061996036166e+04 }},
    ArrayXd{{ -7.4074603951134925e+00, -6.1785026398833507e+00, -6.0644019569320605e+01,  9.8378507525431942e+01, -1.5012512144831009e+01, -7.6698427309937486e+01, -7.4097962025258279e-01,  4.1784704175345944e+06,  1.4085266119595954e+03,  4.2669600050599559e+05,  2.0635610421150943e+05, -1.9862821300357693e+04 }},
    ArrayXd{{ -7.3742831338771442e+00, -6.1157895171281531e+00, -6.0512611476848711e+01,  9.8529402342160580e+01, -1.4754763211917298e+01, -7.5443953331033356e+01, -7.5795209760168414e-01,  4.1784698121876814e+06,  1.4088895868826380e+03,  4.2669617672579503e+05,  2.0634639592385417e+05, -2.0498639689183365e+04 }},
};

TEST_CASE("Testing ActivityModelExtendedUNIQUAC", "[ActivityModelExtendedUNIQUAC]")
{
    auto const db = Database::embedded("ExtendedUNIQUAC.v2023.yaml");
    auto const params = Params::embedded("ExtendedUNIQUAC.v2023.yaml");

    auto const species = SpeciesList("H2O CO2 HCO3- CO3-2 Na+ Ba+2 H+ Cl- HSO4- SO4-2 OH-");

    ActivityModel fn = ActivityModelExtendedUNIQUAC()(species);

    ActivityProps props = ActivityProps::create(species.size());

    for(auto [i, input] : enumerate(inputs))
    {
        auto const T = input[0];
        auto const P = input[1];
        auto const n = input.tail(input.size() - 2);
        auto const x = ArrayXr(n / n.sum());

        fn(props, {T, P, x});

        CHECK( props.ln_g[0].val()/ln10  == Approx(outputs[i][0]) ); // H2O
        CHECK( props.ln_g[1].val()/ln10  == Approx(outputs[i][1]) ); // CO2
        CHECK( props.ln_g[2].val()/ln10  == Approx(outputs[i][2]) ); // HCO3-
        CHECK( props.ln_g[3].val()/ln10  == Approx(outputs[i][3]) ); // CO3-2
        CHECK( props.ln_g[4].val()/ln10  == Approx(outputs[i][4]) ); // Na+
        CHECK( props.ln_g[5].val()/ln10  == Approx(outputs[i][5]) ); // Ba+2
        CHECK( props.ln_g[6].val()/ln10  == Approx(outputs[i][6]) ); // H+
        CHECK( props.ln_g[7].val()/ln10  == Approx(outputs[i][7]) ); // Cl-
        CHECK( props.ln_g[8].val()/ln10  == Approx(outputs[i][8]) ); // HSO4-
        CHECK( props.ln_g[9].val()/ln10  == Approx(outputs[i][9]) ); // SO4-2
        CHECK( props.ln_g[10].val()/ln10  == Approx(outputs[i][10]) ); // OH-
        CHECK( props.Gx == Approx(outputs[i][11]) ); // Gx
    }
}
